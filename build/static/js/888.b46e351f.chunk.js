"use strict";(self.webpackChunknav=self.webpackChunknav||[]).push([[888],{8039:(e,t,a)=>{a.d(t,{Z:()=>n});a(2791);var s=a(184);const n=e=>(0,s.jsx)("div",{className:"table-wrapper",children:e.children})},4440:(e,t,a)=>{a.d(t,{Z:()=>D});var s=a(2481),n=a(2791),o=(a(5960),a(6849)),l=a(2918),r=a(3341),d=a(2040),i=a(9256),c=a(9900);const u=a.p+"static/media/lesediObedNkosiB.7c7f0d4c321de0e4e39d.geojson",v=a.p+"static/media/lesediObedNkosiC.9980411127fa176f8077.geojson";var p=a(2116),m=a(5152),h=a(184);const b=e=>{let{children:t}=e;return t},f={"Obed Nkosi A":{lat:-26.541960658447646,lng:28.338629116440828},"Obed Nkosi B":{lat:-26.52888160075503,lng:28.3352936276032},"Obed Nkosi C":{lat:-26.532998883501552,lng:28.345134598723572}};function g(e){const{area:t}=(0,n.useContext)(m.X),a=(0,n.useRef)(),{openModal:s}=(0,l.Z)(),[o,r]=(0,n.useState)(e.rowData);(0,n.useEffect)((()=>{r(e.rowData)}),[e.rowData]);const{setGeolocation:g,userGps:x}=(0,p.Z)(),N=null===o||void 0===o?void 0:o.map((e=>({type:"Feature",properties:{cluster:!1,erfId:e.id,erf:e},geometry:{type:"Point",coordinates:[parseFloat(e.address.gps.longitude),parseFloat(e.address.gps.latitude)]}}))),[j,y]=(0,n.useState)([]),[w,k]=(0,n.useState)(10),C=(0,i.Z)({points:N,bounds:j,zoom:w,options:{radius:75,maxZoom:20}}),{clusters:D,supercluster:E}=C,[S,T]=(0,n.useState)(""),[Z,I]=(0,n.useState)(""),[G,O]=(0,n.useState)("");(0,n.useEffect)((()=>{const e=null===o||void 0===o?void 0:o.filter((e=>e.erfNo.includes(Z)));O(e)}),[Z]);const M=(null===Z||void 0===Z?void 0:Z.length)>0?"show-erfs":"hide-erfs";(0,n.useEffect)((()=>{if(S){var e,t,s,n,o,l;const r=null===S||void 0===S||null===(e=S.address)||void 0===e||null===(t=e.gps)||void 0===t?void 0:t.latitude,d=null===S||void 0===S||null===(s=S.address)||void 0===s||null===(n=s.gps)||void 0===n?void 0:n.longitude;null===(o=a.current)||void 0===o||o.panTo({lat:r,lng:d}),null===(l=a.current)||void 0===l||l.setZoom(20)}}),[S]);(0,n.useEffect)((()=>{var e,s,n,o,l,r,d,i,p,m,h,b,f,g;(null===(e=a.current)||void 0===e||null===(s=e.data)||void 0===s||s.forEach((function(e){var t;null===(t=a.current)||void 0===t||t.data.remove(e)})),"Obed Nkosi A"===(null===t||void 0===t?void 0:t.name))&&(null===(n=a.current)||void 0===n||null===(o=n.data)||void 0===o||o.loadGeoJson(c));"Obed Nkosi B"===(null===t||void 0===t?void 0:t.name)&&(null===(l=a.current)||void 0===l||null===(r=l.data)||void 0===r||r.loadGeoJson(u));"Obed Nkosi C"===(null===t||void 0===t?void 0:t.name)&&(null===(d=a.current)||void 0===d||null===(i=d.data)||void 0===i||i.loadGeoJson(v));"Obed Mthombeni Nkosi"===(null===t||void 0===t?void 0:t.name)&&(null===(p=a.current)||void 0===p||null===(m=p.data)||void 0===m||m.loadGeoJson(c),null===(h=a.current)||void 0===h||null===(b=h.data)||void 0===b||b.loadGeoJson(u),null===(f=a.current)||void 0===f||null===(g=f.data)||void 0===g||g.loadGeoJson(v))}),[t]);return(0,h.jsxs)("div",{className:"tabs-erfs-map",children:[(0,h.jsxs)("div",{className:"search-box",children:[(0,h.jsx)("input",{className:"erf-search",type:"text",placeholder:" enter erf no",onChange:e=>I(e.target.value),value:Z}),(0,h.jsx)("div",{className:"search-dropdown ".concat(M," "),children:G&&(null===G||void 0===G?void 0:G.map((e=>{var t,a,s,n;const o=null===e||void 0===e?void 0:e.erfNo,l=null!==(t=e.propertyType)&&void 0!==t&&t.unitName?"| ".concat(null===(a=e.propertyType)||void 0===a?void 0:a.unitName):"",r=null!==(s=e.propertyType)&&void 0!==s&&s.unitNo?"| ".concat(null===(n=e.propertyType)||void 0===n?void 0:n.unitNo):"";return(0,h.jsx)("p",{onClick:()=>(e=>{T(e)})(e),children:"".concat(o," ").concat(l," ").concat(r," ")},e.id)})))})]}),(0,h.jsxs)(d.ZP,{bootstrapURLKeys:{key:"AIzaSyCj8IfmDEGxDWEXesDKBanx6HDp_1jxluI"},defaultCenter:{lat:-26.135604364944857,lng:28.68808787106989},center:f[t.name],defaultZoom:16,yesIWantToUseGoogleMapApiInternals:!0,onGoogleApiLoaded:e=>{var t,s;const{map:n,maps:o}=e;a.current=n,null===(t=a.current)||void 0===t||null===(s=t.data)||void 0===s||s.setStyle({fillOpacity:0})},onChange:e=>{const{zoom:t,bounds:a}=e;k(t),y([a.nw.lng,a.se.lat,a.se.lng,a.nw.lat])},options:{mapTypeControl:!0,overviewMapControl:!0,rotateControl:!0,fullscreenControl:!1},children:[D.map((e=>{var t,n,l,r,d,i,c,u,v,p;const[m,f]=e.geometry.coordinates,{cluster:g,point_count:x}=e.properties,j=null===e||void 0===e||null===(t=e.properties)||void 0===t||null===(n=t.erf)||void 0===n?void 0:n.erfNo,y=null===e||void 0===e||null===(l=e.properties)||void 0===l||null===(r=l.erf)||void 0===r?void 0:r.id,w=(null===e||void 0===e||null===(d=e.properties)||void 0===d||null===(i=d.erf)||void 0===i||null===(c=i.asts)||void 0===c?void 0:c.length)>0?"has-asts":"";null===e||void 0===e||null===(u=e.properties)||void 0===u||null===(v=u.erf)||void 0===v||null===(p=v.asts)||void 0===p||p.length;return g?(0,h.jsx)(b,{lat:f,lng:m,children:(0,h.jsx)("div",{className:"cluster-marker",style:{width:"".concat(10+x/N.length*20,"px"),height:"".concat(10+x/N.length*20,"px"),backgroundColor:"#ff66ff"},onClick:()=>{const t=Math.min(E.getClusterExpansionZoom(e.id),20);a.current.setZoom(t),a.current.panTo({lat:f,lng:m})},children:x})},"".concat(e.id)):(0,h.jsx)(b,{lat:f,lng:m,children:(0,h.jsx)("button",{className:"erf-marker",onClick:()=>((e,t,n)=>{var l;null===(l=a.current)||void 0===l||l.panTo({lat:t,lng:n});const r=o.find((t=>t.id===e));r&&s({modalName:"tabsErfMapInfoWrapper",payload:r})})(y,f,m),children:(0,h.jsx)("span",{className:"erf-no ".concat(w," ").concat(""),children:j})})},"".concat(e.properties.erfId))})),(0,h.jsx)(b,{position:{lat:x.coordinates.lat,lng:x.coordinates.lng},children:(0,h.jsx)("div",{className:"userGpsPosition"})})]})]})}a(1350);var x=a(528),N=a(4867),j=a(8039);const y=(e,t,a,s,n)=>"asts"===e||"trns"===e||"erfs"===e?null:(0,h.jsx)(N.Z,{nfd:s,fn:n}),w=e=>{const{ml1:t,tn:a,ml3:s,nfd:n,fn:o,rowData:l,columnDefs:r,setSelectedRows:d}=e;return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(j.Z,{rowData:l,columnDefs:r,ml1:t,children:(0,h.jsx)(x.Z,{rowData:l,columnDefs:r,setSelectedRows:d,ml1:t})}),y(t,0,0,n,o)]})},k=(e,t,a)=>{const n=[];return 0===e.lenght?n:e?(e.map((e=>{let o={};if("inspection"===t&&(o=(e=>{console.log("erf",e);const{asts:t}=e;if(console.log("asts",t),!t)return null;const a={};return t&&t.forEach((e=>{const{astId:t}=e;console.log("astId",t);const s=e.astData.astCartegory,{trnData:n}=r.m[s].inspection;if(e={...e,trnData:n},s)if(a[s]){const n=a[s].some((e=>e.astId===t));if(n){delete e.trnMetaData,delete e.astData,delete e.astId;const n=Object.entries(e)[0][0],o=a[s].findIndex((e=>e.astId===t));a[s][o]={...a[s][o],[n]:e[n]}}else a[s].push(e)}else a[s]=[],delete e.trnMetaData,a[s].push(e)})),a})(e),!o))return null;if("installation"===t||"audit"===t||"inspection"===t){const l={metaData:{createdAtDatetime:s.EK.now(),createdByUser:a.displayName,createdByUserId:a.uid,updatedAtDatetime:s.EK.now(),updatedByUser:a.displayName,trnHistory:0,trnType:t,trnNo:"",trnState:"draft"},erfData:e,astData:o};return n.push(l)}})),n):void 0},C=[{key:"choose",value:"choose"},{key:"audit",value:"audit"},{key:"inspection",value:"inspection"}],D=e=>{const[t,a]=(0,n.useState)(""),{purpose:s}=e,[r,d]=(0,n.useState)("tabs-map"),[i,c]=(0,n.useState)([]),{openModal:u}=(0,l.Z)(),{user:v}=(0,o.Z)(),p=e=>{d(e.target.id)};return(0,n.useEffect)((()=>{a("choose")}),[]),(0,h.jsxs)("div",{className:"tabs",children:[(0,h.jsxs)("div",{className:"tabs-header",children:[(0,h.jsx)("div",{className:"tab-title",children:(0,h.jsx)("p",{children:"Erfs Table"})}),"firestoreErfs"===s?(0,h.jsxs)("div",{className:"new-trn-div",children:[" ",(0,h.jsx)("button",{className:"new-trn new-trn-btn",disabled:"choose"===t||0===i.length,onClick:()=>{if(t){const e=k(i,t,v);e.length>0&&(u({modalName:"tableTrnsFromErfs",payload:{newTrnsArray:e,trnType:t}}),a("choose"))}},children:"NT"})," ",(0,h.jsx)("select",{className:"new-trn new-trn-select",value:t,onChange:e=>a(e.target.value),placeholder:"Store Name",children:C&&C.map((e=>(0,h.jsx)("option",{value:e.value,children:e.value},e.key)))})]}):(0,h.jsx)("div",{}),(0,h.jsxs)("div",{className:"tabs-btns",children:[" ",(0,h.jsx)("div",{className:"tabs-header-table ".concat("tabs-table"===r?"tab-active":""," tabs-tab"),id:"tabs-table",onClick:p,children:"Table"}),(0,h.jsx)("div",{className:"tabs-header-map ".concat("tabs-map"===r?"tab-active":""," tabs-tab"),id:"tabs-map",onClick:p,children:"Map"})]})]}),(0,h.jsxs)("div",{className:"tabs-body",children:[(0,h.jsx)("div",{className:"tabs-body-content tabs-table ".concat("tabs-table"===r?"tabs-show":"tabs-hide","  "),id:"tabs-table",children:(0,h.jsx)(w,{...e,setSelectedRows:c})}),(0,h.jsx)("div",{className:"tabs-body-content tabs-map ".concat("tabs-map"===r?"tabs-show":"tabs-hide"," "),id:"tabs-map",children:(0,h.jsx)(g,{...e})}),(0,h.jsx)("div",{className:"tabs-body-content tabs-tree ".concat("tabs-tree"===r?"tabs-show":"tabs-hide"," "),id:"tabs-tree"})]})]})}},8360:()=>{}}]);
//# sourceMappingURL=888.b46e351f.chunk.js.map